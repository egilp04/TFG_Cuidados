<div class="w-full mb-4">
  <app-buttonback></app-buttonback>
</div>

<div class="flex flex-col items-center p-6 bg-surface">
  @if (this.messageService.messageData(); as data) {
  <div
    [ngClass]="{
      'text-red-500': data.tipo === 'error',
      'text-primary': data.tipo === 'exito'
    }"
    class="text-label ml-2 transition-all duration-300"
  >
    {{ data.mensaje }}
  </div>
  }
</div>

<div class="flex flex-col items-center p-6 bg-surface">
  <h1 class="w-full text-h1 text-primary font-serif mb-6 text-center">
    {{ 'MESSAGES_PAGE.TITLE' | translate }}
  </h1>

  <div class="flex flex-row justify-between w-full items-start gap-4 px-10 m-10">
    <div class="flex-none">
      <button
        class="flex items-center gap-2 px-6 py-3 border rounded-12 border-primary text-primary hover:bg-primary hover:text-white transition-all cursor-pointer"
        (click)="escribirMensaje()"
      >
        <img
          src="assets/icons/editar.webp"
          class="h-20 w-20 2xl:h-7.5 2xl:w-7.5"
          alt="nuevo mensaje"
        />
        <span class="text-label font-bold">
          {{ 'MESSAGES_PAGE.NEW_MSG' | translate }}
        </span>
      </button>
    </div>

    <div class="relative">
      <app-dropdown
        [label]="'MESSAGES_PAGE.SORT_LABEL' | translate"
        [options]="[
          'MESSAGES_PAGE.SORT_OPTIONS.DATE',
          'MESSAGES_PAGE.SORT_OPTIONS.SUBJECT_AZ',
          'MESSAGES_PAGE.SORT_OPTIONS.SUBJECT_ZA'
        ]"
        (onSelect)="ordenar($event)"
      ></app-dropdown>
    </div>
  </div>

  <div class="flex flex-col p-10 w-full">
    <div class="overflow-auto bg-surface">
      <table mat-table [dataSource]="dataSource" class="w-full">
        <ng-container matColumnDef="Emisor">
          <th mat-header-cell *matHeaderCellDef class="bg-surface! text-primary! text-label! p-4">
            {{ 'MESSAGES_PAGE.TABLE.SENDER' | translate }}
          </th>
          <td mat-cell *matCellDef="let mensaje" class="p-4">
            {{ mensaje.Emisor?.nombre || 'Desconocido' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="Receptor">
          <th mat-header-cell *matHeaderCellDef class="bg-surface! text-primary! text-label! p-4">
            {{ 'MESSAGES_PAGE.TABLE.RECEIVER' | translate }}
          </th>
          <td mat-cell *matCellDef="let mensaje" class="p-4">
            {{ mensaje.Receptor?.nombre || 'Desconocido' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="Asunto">
          <th mat-header-cell *matHeaderCellDef class="bg-surface! text-primary! text-label! p-4">
            {{ 'MESSAGES_PAGE.TABLE.SUBJECT' | translate }}
          </th>
          <td mat-cell *matCellDef="let mensaje" class="p-4">
            {{ mensaje.asunto }}
          </td>
        </ng-container>

        <ng-container matColumnDef="Fecha">
          <th mat-header-cell *matHeaderCellDef class="bg-surface! text-primary! text-label! p-4">
            {{ 'MESSAGES_PAGE.TABLE.DATE' | translate }}
          </th>
          <td mat-cell *matCellDef="let mensaje" class="p-4">
            {{ mensaje.fecha_envio | date : 'dd/MM/yyyy' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="bg-surface! text-primary! textlabel! p-4"
          ></th>
          <td mat-cell *matCellDef="let mensaje" class="p-4 text-center">
            <div class="flex justify-center gap-4 p-10">
              <app-button
                [label]="'MESSAGES_PAGE.TABLE.BTN_DELETE' | translate"
                variant="secondary"
                (click)="borrarMensaje(mensaje)"
              ></app-button>
              <app-button
                [label]="'MESSAGES_PAGE.TABLE.BTN_VIEW' | translate"
                variant="primary"
                (click)="verMensaje(mensaje)"
              ></app-button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="bg-surface text-label transition-colors duration-300"
          [ngClass]="{
            '[&>*]:!text-red-500 font-bold':
              !row.leido && row.id_receptor === authService.currentUser()?.id_usuario,
            '[&>*]:!text-primary': row.leido
          }"
        ></tr>
      </table>
    </div>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
      class="bg-surface! mt-10 border-none!"
    >
    </mat-paginator>
  </div>
</div>
